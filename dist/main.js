"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("rxjs-compat/bundles/rxjs-compat.umd.min.js"),t=require("assert"),r=require("log4js"),n=require("atom"),o=require("path"),i=require("os");function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=a(e),u=a(t),l=a(r),c=a(n),f=a(o),p=a(i);var d={};Object.defineProperty(d,"__esModule",{value:!0});var h=d.default=function(e){if(null!=e)return e;throw new Error("Got unexpected null or undefined")},m={},g={},b={};Object.defineProperty(b,"__esModule",{value:!0}),b.default=function(e){if("string"==typeof e.displayName&&""!==e.displayName)return e.displayName;if("string"==typeof e.name&&""!==e.name)return e.name;return"Unknown"};var y={};Object.defineProperty(y,"__esModule",{value:!0});var v=y.default=void 0;class _{constructor(...e){this.disposed=void 0,this.teardowns=void 0,this.teardowns=new Set,this.disposed=!1,e.length&&this.add(...e)}add(...e){if(this.disposed)throw new Error("Cannot add to an already disposed UniversalDisposable!");for(let t=0;t<e.length;t++)w(e[t]),this.teardowns.add(e[t])}addUntilDestroyed(e,...t){if(this.disposed)throw new Error("Cannot add to an already disposed UniversalDisposable!");const r=new _(...t,e.onDidDestroy((()=>{r.dispose(),this.remove(r)})));this.add(r)}remove(e){this.disposed||this.teardowns.delete(e)}dispose(){this.disposed||(this.disposed=!0,this.teardowns.forEach((e=>{"function"==typeof e.dispose?e.dispose():"function"==typeof e.unsubscribe?e.unsubscribe():"function"==typeof e.destroy?e.destroy():"function"==typeof e&&e()})),this.teardowns=null)}unsubscribe(){this.dispose()}clear(){this.disposed||this.teardowns.clear()}}function w(e){if("function"!=typeof e.dispose&&"function"!=typeof e.unsubscribe&&"function"!=typeof e.destroy&&"function"!=typeof e)throw new TypeError("Arguments to UniversalDisposable.add must be disposable")}v=y.default=_;var E={};Object.defineProperty(E,"__esModule",{value:!0}),E.sleep=T,E.nextTick=function(){return new Promise((e=>{process.nextTick(e)}))},E.triggerAfterWait=async function(e,t,r,n){const o=setTimeout(r,t);try{return await e}finally{clearTimeout(o),n&&n()}},E.timeoutPromise=S,E.createDeadline=function(e){return Date.now()+e},E.timeoutAfterDeadline=function(e,t){const r=e-Date.now();return S(t,r<0?0:r)},E.retryLimit=async function(e,t,r,n=0){let o=null,i=0,a=null;for(;0===i||i<r;){try{if(o=await e(),a=null,t(o))return o}catch(e){a=e,o=null}++i<r&&0!==n&&await T(n)}if(null!=a)throw a;if(i===r)throw new Error("No valid response found!");return o},E.serializeAsyncCall=function(e){let t=null,r=null;const n=()=>{const t=e();return r=t.then((()=>r=null),(()=>r=null)),t},o=()=>(t=null,n());return()=>null==r?n():(null==t&&((0,P.default)(r,"pendingCall must not be null!"),t=r.then(o,o)),t)},E.asyncFind=function(e,t,r){let n=e;return new Promise(((e,o)=>{n=n.slice();const i=n.length,a=async function(o){if(o===i)return void e(null);const s=n[o],u=await t.call(r,s);null!=u?e(u):a(o+1)};a(0)}))},E.denodeify=function(e){return function(...t){return new Promise(((r,n)=>{e.apply(this,t.concat([function(e,t){e?n(e):r(t)}]))}))}},E.asyncLimit=R,E.asyncFilter=async function(e,t,r){const n=[];return await R(e,r||e.length,(async e=>{await t(e)&&n.push(e)})),n},E.asyncObjFilter=async function(e,t,r){const n=Object.keys(e),o={};return await R(n,r||n.length,(async r=>{const n=e[r];await t(n,r)&&(o[r]=n)})),o},E.asyncSome=async function(e,t,r){let n=!1;return await R(e,r||e.length,(async e=>{n||await t(e)&&(n=!0)})),n},E.isPromise=function(e){return Boolean(e)&&"object"==typeof e&&"function"==typeof e.then},E.lastly=function(e,t){return e.then((e=>Promise.resolve(t()).then((()=>e))),(e=>Promise.resolve(t()).then((()=>Promise.reject(e)))))},E.delayTime=function(e){return new Promise(((t,r)=>{setTimeout(t,e)}))},E.PromiseWithState=E.Deferred=E.TimedOutError=E.RequestSerializer=void 0;var O,P=(O=u.default)&&O.__esModule?O:{default:O};function T(e){return new Promise((t=>{setTimeout(t,e)}))}E.RequestSerializer=class{constructor(){this._lastDispatchedOp=void 0,this._lastFinishedOp=void 0,this._latestPromise=void 0,this._waitResolve=void 0,this._lastDispatchedOp=0,this._lastFinishedOp=0,this._latestPromise=new Promise(((e,t)=>{this._waitResolve=e}))}async run(e){const t=this._lastDispatchedOp+1;this._lastDispatchedOp=t,this._latestPromise=e,this._waitResolve();const r=await e;return this._lastFinishedOp<t?(this._lastFinishedOp=t,{status:"success",result:r}):{status:"outdated"}}async waitForLatestResult(){let e=null,t=null;for(;e!==this._latestPromise;)e=this._latestPromise,t=await new Promise(((e,t)=>{this._waitResolve=e,this._latestPromise.then(e)}));return t}isRunInProgress(){return this._lastDispatchedOp>this._lastFinishedOp}};class x extends Error{constructor(e){super(`Timed out after ${String(e)} ms`),this.timeout=void 0,this.timeout=e}}function S(e,t){return new Promise(((r,n)=>{let o=setTimeout((()=>{o=null,n(new x(t))}),t);e.then((e=>{null!=o&&clearTimeout(o),r(e)})).catch((e=>{null!=o&&clearTimeout(o),n(e)}))}))}E.TimedOutError=x;function R(e,t,r){const n=new Array(e.length);let o=0,i=0,a=Math.min(t,e.length)||1;return new Promise(((t,s)=>{const u=async()=>{if(i===e.length)return void(0===o&&t(n));++o;const a=i++;try{n[a]=await r(e[a])}catch(e){s(e)}--o,u()};for(;a--;)u()}))}E.Deferred=class{constructor(){this.promise=void 0,this.resolve=void 0,this.reject=void 0,this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}};E.PromiseWithState=class{constructor(e){this._promise=void 0,this._state=void 0,this._state={kind:"pending"},this._promise=e.then((e=>(this._state={kind:"fulfilled",value:e},e)),(e=>{throw this._state={kind:"rejected",error:e},e}))}getPromise(){return this._promise}getState(){return this._state}};var A={};Object.defineProperty(A,"__esModule",{value:!0}),A.default=void 0;var j="undefined"!=typeof performance?()=>performance.now():()=>{const[e,t]=process.hrtime();return 1e3*e+t/1e6};A.default=j,Object.defineProperty(g,"__esModule",{value:!0}),g.track=U,g.isTrackSupported=function(){return N.isTrackSupported()},g.trackImmediate=function(e,t){return N.track(e,t||{},!0)||Promise.resolve()},g.trackEvent=F,g.trackEvents=function(e){return new I.default(e.subscribe(F))},g.trackSampled=L,g.startTracking=W,g.trackTiming=q,g.decorateTrackTiming=z,g.trackTimingSampled=V,g.decorateTrackTimingSampled=H,g.setRawAnalyticsService=function(e,t){e.setApplicationSessionObservable(t),N=e},g.default=g.TimingTracker=void 0;var M=D(b),I=D(y),k=E,C=D(A);function D(e){return e&&e.__esModule?e:{default:e}}let N={track(){},isTrackSupported:()=>!1,setApplicationSessionObservable:e=>{}};function U(e,t){N.track(e,t||{})}function F(e){U(e.type,e.data)}function L(e,t,r){Math.random()*t<=1&&N.track(e,{...r,sample_rate:t})}const B="undefined"!=typeof performance;class ${constructor(e,t){this._eventName=void 0,this._startTime=void 0,this._startMark=void 0,this._values=void 0,this._eventName=e,this._startMark=`${this._eventName}_${$.eventCount++}_start`,this._startTime=(0,C.default)(),this._values=t,B&&performance.mark(this._startMark)}onError(e){this._trackTimingEvent(e)}onCancel(){this._trackTimingEvent(null,!0)}onSuccess(){this._trackTimingEvent(null)}_trackTimingEvent(e,t=!1){B&&(performance.measure(this._eventName,this._startMark),performance.clearMarks(this._startMark),performance.clearMeasures(this._eventName)),U("performance",{...this._values,duration:Math.round((0,C.default)()-this._startTime).toString(),eventName:this._eventName,error:e?"1":"0",exception:e?e.toString():"",canceled:t})}}function W(e,t={}){return new $(e,t)}function q(e,t,r={}){const n=W(e,r);try{const e=t();return(0,k.isPromise)(e)?e.then((e=>(n.onSuccess(),e)),(e=>(n.onError(e instanceof Error?e:new Error(e)),Promise.reject(e)))):(n.onSuccess(),e)}catch(e){throw n.onError(e),e}}function z(e,t={}){const r=(0,M.default)(e);function n(...n){return q(r,e.bind(this,...n),t)}return n.displayName=`trackTiming(${r})`,n}function V(e,t,r,n={}){return Math.random()*r<=1?q(e,t,{...n,sample_rate:r}):t()}function H(e,t,r={}){const n=(0,M.default)(e);function o(...o){return V(n,e.bind(this,...o),t,r)}return o.displayName=`trackTimingSampled(${n})`,o}g.TimingTracker=$,$.eventCount=0;var G={track:U,trackSampled:L,trackEvent:F,trackTiming:q,trackTimingSampled:V,startTracking:W,TimingTracker:$,decorateTrackTiming:z,decorateTrackTimingSampled:H};g.default=G;var K={};Object.defineProperty(K,"__esModule",{value:!0});var X=K.default=void 0,Y=function(e){return e&&e.__esModule?e:{default:e}}(y);X=K.default=class{constructor(){this._providers=void 0,this._providers=[]}addProvider(e){const t=this._providers.findIndex((t=>e.priority>t.priority));return-1===t?this._providers.push(e):this._providers.splice(t,0,e),new Y.default((()=>{this.removeProvider(e)}))}removeProvider(e){const t=this._providers.indexOf(e);-1!==t&&this._providers.splice(t,1)}getProviderForEditor(e){const t=e.getGrammar().scopeName;return this.findProvider(t)}getAllProvidersForEditor(e){const t=e.getGrammar().scopeName;return this.findAllProviders(t)}findProvider(e){for(const t of this.findAllProviders(e))return t;return null}*findAllProviders(e){for(const t of this._providers)null!=t.grammarScopes&&-1===t.grammarScopes.indexOf(e)||(yield t)}};var Z={},J={},Q={};Object.defineProperty(Q,"__esModule",{value:!0}),Q.attachEvent=function(e,t,r){return e.addListener(t,r),new te.default((()=>{e.removeListener(t,r)}))};var ee=Q.observableFromSubscribeFunction=function(e){return re.Observable.create((t=>new te.default(e(t.next.bind(t)))))},te=function(e){return e&&e.__esModule?e:{default:e}}(y),re=s.default;Object.defineProperty(J,"__esModule",{value:!0}),J.existingEditorForUri=function(e){for(const t of atom.workspace.getTextEditors())if(t.getPath()===e)return t;return null},J.existingEditorForBuffer=function(e){for(const t of atom.workspace.getTextEditors())if(t.getBuffer()===e)return t;return null},J.getViewOfEditor=ue,J.getScrollTop=function(e){return ue(e).getScrollTop()},J.setScrollTop=le,J.setPositionAndScroll=function(e,t,r){e.setCursorBufferPosition(t,{autoscroll:!1}),le(e,r)},J.getCursorPositions=function(e){return ae.Observable.defer((()=>{const t=e.getCursors()[0];return(0,oe.default)(null!=t),ae.Observable.merge(ae.Observable.of(t.getBufferPosition()),(0,se.observableFromSubscribeFunction)(t.onDidChangePosition.bind(t)).map((e=>e.newBufferPosition)))}))};var ne=J.observeEditorDestroy=function(e){return(0,se.observableFromSubscribeFunction)(e.onDidDestroy.bind(e)).map((t=>e)).take(1)};J.enforceReadOnlyEditor=function(e,t=["append","setText"]){return e.getElement().setAttribute("readonly",""),{dispose(){e.getElement().removeAttribute("readonly")}}},J.enforceSoftWrap=function(e,t){return e.setSoftWrapped(t),e.onDidChangeSoftWrapped((r=>{r!==t&&process.nextTick((()=>{e.isDestroyed()||e.setSoftWrapped(t)}))}))},J.isValidTextEditor=function(e){return e instanceof ie.TextEditor},J.centerScrollToBufferLine=function(e,t){const r=e.getModel(),n=e.pixelPositionForBufferPosition([t,0]).top+r.getLineHeightInPixels()/2-e.clientHeight/2;e.setScrollTop(Math.max(n,1)),e.focus(),r.setCursorBufferPosition([t,0],{autoscroll:!1})};var oe=function(e){return e&&e.__esModule?e:{default:e}}(u.default),ie=c.default,ae=s.default,se=Q;function ue(e){return atom.views.getView(e)}function le(e,t){ue(e).setScrollTop(t)}var ce={};Object.defineProperty(ce,"__esModule",{value:!0}),ce.goToLocation=async function(e,t){var r,n,o;const i=null===(r=null==t?void 0:t.center)||void 0===r||r,a=null===(n=null==t?void 0:t.moveCursor)||void 0===n||n,s=null===(o=null==t?void 0:t.activatePane)||void 0===o||o,u=null==t?void 0:t.activateItem,l=null==t?void 0:t.line,c=null==t?void 0:t.column,f=null==t?void 0:t.pending,p=atom.workspace.getActiveTextEditor();if(null!=p&&p.getPath()===e){const e=atom.workspace.paneContainerForItem(p);return(0,de.default)(null!=e),s&&e.activate(),null!=l?me(p,{line:l,column:null==c?0:c,center:i,moveCursor:a}):(0,de.default)(null==c,"goToLocation: Cannot specify just column"),p}{const t=await atom.workspace.open(e,{initialLine:l,initialColumn:c,searchAllPanes:!0,activatePane:s,activateItem:u,pending:f});if(null==t){const t={};Error.captureStackTrace(t);const r=Error(`atom.workspace.open returned null on ${e}`);throw(0,fe.getLogger)("goToLocation").error(r),r}return i&&null!=l&&t.scrollToBufferPosition([l,c],{center:!0}),t}},ce.goToLocationInEditor=me,ce.observeNavigatingEditors=function(){return he};var fe=l.default,pe=s.default,de=function(e){return e&&e.__esModule?e:{default:e}}(u.default);const he=new pe.Subject;function me(e,t){const r=null==t.center||t.center,n=null==t.moveCursor||t.moveCursor,{line:o,column:i}=t;n&&e.setCursorBufferPosition([o,i]),r&&e.scrollToBufferPosition([o,i],{center:!0}),he.next(e)}Object.defineProperty(Z,"__esModule",{value:!0}),Z.applyTextEditsForMultipleFiles=async function(e){const t=Array.from(e.keys()),r=(await Promise.all(t.map((async e=>(0,_e.goToLocation)(e))))).map((e=>{(0,be.default)(null!=e);const t=e.getBuffer();return[t,t.createCheckpoint()]})),n=t.reduce(((t,r)=>{const n=e.get(r);return t&&null!=n&&we(r,...n)}),!0);n||r.forEach((([e,t])=>(e.revertToCheckpoint(t),!1)));return n},Z.applyTextEdits=we;var ge=Z.applyTextEditsToBuffer=function(e,t){return Ee(e,Pe(t))},be=function(e){return e&&e.__esModule?e:{default:e}}(u.default),ye=l.default,ve=J,_e=ce;function we(e,...t){const r=Pe(t),n=(0,ve.existingEditorForUri)(e);return(0,be.default)(null!=n),Ee(n.getBuffer(),r)}function Ee(e,t){if(function(e){for(let t=0;t<e.length-1;t++)if(e[t].oldRange.end.isGreaterThan(e[t+1].oldRange.start))return!0;return!1}(t))return(0,ye.getLogger)("text-edit").warn("applyTextEdits was called with overlapping edits."),!1;if(1===t.length&&t[0].oldRange.isEqual(e.getRange()))return(null==t[0].oldText||t[0].oldText===e.getText())&&(e.setTextViaDiff(t[0].newText),!0);const r=e.createCheckpoint();for(let n=t.length-1;n>=0;n--){if(!Oe(e,t[n]))return e.revertToCheckpoint(r),!1}return e.groupChangesSinceCheckpoint(r),!0}function Oe(e,t){if(t.oldRange.start.row===t.oldRange.end.row){const r=e.lineLengthForRow(t.oldRange.start.row);if(t.oldRange.end.column>r)return!1}if(null!=t.oldText){if(e.getTextInRange(t.oldRange)!==t.oldText)return!1}return e.setTextInRange(t.oldRange,t.newText),!0}function Pe(e){return e.map(((e,t)=>[e,t])).sort((([e,t],[r,n])=>e.oldRange.start.compare(r.oldRange.start)||e.oldRange.end.compare(r.oldRange.end)||t-n)).map((([e])=>e))}Object.defineProperty(m,"__esModule",{value:!0});var Te=m.registerOnWillSave=function(e){return Ie.addProvider(e)};m.observeTextEditors=function(){const e=new je.default;return e.add(atom.workspace.observeTextEditors((t=>{e.add(function(e){const t=e.save,r=e;return r.save=async()=>{const n=new Date;n.setTime(n.getTime()+5e3);try{await function(e){if(null==e.getPath())return xe.Observable.empty();const t=Array.from(Ie.getAllProvidersForEditor(e));return xe.Observable.concat(...t.map((t=>t.callback(e).toArray().race(xe.Observable.of([]).delay(t.timeout)).map((t=>(0,Ae.applyTextEditsToBuffer)(e.getBuffer(),t))))))}(r).timeout(n).toPromise()}catch(t){const n=Array.from(Ie.getAllProvidersForEditor(r));(0,Se.track)("timeout-on-save",{uri:e.getPath(),providers:n})}finally{await t.call(e)}},new je.default((()=>{r.save=t}))}(t))}))),e};var xe=s.default,Se=g,Re=Me(K),Ae=Z,je=Me(y);function Me(e){return e&&e.__esModule?e:{default:e}}const Ie=new Re.default;var ke={},Ce={};Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.default=void 0;var De=function(e){return e&&e.__esModule?e:{default:e}}(u.default),Ne=s.default;Ce.default=class{constructor(e){this._packageName=void 0,this._config=void 0,this._config=e}getConfig(){return this._config}setPackageName(e){this._packageName=e}getPackageName(){return(0,De.default)(null!=this._packageName,"No package name available"),this._packageName}formatKeyPath(e){return null==this._packageName?e:`${this._packageName}.${e}`}get(e,t){return this._config.get(this.formatKeyPath(e),...null==t?[]:[t])}getWithDefaults(e,t,r){const n=this.get(e,r);return null==n?t:n}getSchema(e){return this._config.getSchema(this.formatKeyPath(e))}observe(e,t,r){return this._config.observe(this.formatKeyPath(e),...Array.prototype.slice.call(arguments,1))}observeAsStream(e,t={}){return Ne.Observable.create((r=>{const n=this.observe(e,t,r.next.bind(r));return n.dispose.bind(n)}))}onDidChange(e,t,r){return this._config.onDidChange(this.formatKeyPath(e),...Array.prototype.slice.call(arguments,1))}set(e,t,r){return this._config.set(this.formatKeyPath(e),...Array.prototype.slice.call(arguments,1))}setSchema(e,t){return this._config.setSchema(this.formatKeyPath(e),...Array.prototype.slice.call(arguments,1))}unset(e,t){return this._config.unset(this.formatKeyPath(e),...Array.prototype.slice.call(arguments,1))}isFeatureDisabled(e){return null==this._packageName?atom.packages.isPackageDisabled(e):atom.packages.isPackageDisabled(this._packageName)||!this._config.get(`${this._packageName}.use.${e}`)}},Object.defineProperty(ke,"__esModule",{value:!0});var Ue=ke.default=void 0;var Fe=new(function(e){return e&&e.__esModule?e:{default:e}}(Ce).default)(atom.config);Ue=ke.default=Fe;var Le,Be,$e={},We={exports:{}};Le=We,void 0!==(Be=function(e,t){function r(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}function n(e){return encodeURIComponent(e).replace(/[!'()*]/g,r)}function o(e){return e.replace(/[#?]/,r)}Object.defineProperty(t,"__esModule",{value:!0});var i,a=function(){function e(){this._scheme=e._empty,this._authority=e._empty,this._path=e._empty,this._query=e._empty,this._fragment=e._empty,this._formatted=null,this._fsPath=null}return e.isUri=function(t){return t instanceof e||!!t&&"string"==typeof t.authority&&"string"==typeof t.fragment&&"string"==typeof t.path&&"string"==typeof t.query&&"string"==typeof t.scheme},Object.defineProperty(e.prototype,"scheme",{get:function(){return this._scheme},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"authority",{get:function(){return this._authority},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"query",{get:function(){return this._query},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragment",{get:function(){return this._fragment},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fsPath",{get:function(){var t;return this._fsPath||(t=this._authority&&this._path&&"file"===this.scheme?"//"+this._authority+this._path:e._driveLetterPath.test(this._path)?this._path[1].toLowerCase()+this._path.substr(2):this._path,i&&(t=t.replace(/\//g,"\\")),this._fsPath=t),this._fsPath},enumerable:!0,configurable:!0}),e.prototype.with=function(t){if(!t)return this;var r=t.scheme,n=t.authority,o=t.path,i=t.query,a=t.fragment;if(void 0===r?r=this.scheme:null===r&&(r=""),void 0===n?n=this.authority:null===n&&(n=""),void 0===o?o=this.path:null===o&&(o=""),void 0===i?i=this.query:null===i&&(i=""),void 0===a?a=this.fragment:null===a&&(a=""),r===this.scheme&&n===this.authority&&o===this.path&&i===this.query&&a===this.fragment)return this;var s=new e;return s._scheme=r,s._authority=n,s._path=o,s._query=i,s._fragment=a,e._validate(s),s},e.parse=function(t){var r=new e,n=e._parseComponents(t);return r._scheme=n.scheme,r._authority=decodeURIComponent(n.authority),r._path=decodeURIComponent(n.path),r._query=decodeURIComponent(n.query),r._fragment=decodeURIComponent(n.fragment),e._validate(r),r},e.file=function(t){var r=new e;if(r._scheme="file",i&&(t=t.replace(/\\/g,e._slash)),t[0]===e._slash&&t[0]===t[1]){var n=t.indexOf(e._slash,2);-1===n?r._authority=t.substring(2):(r._authority=t.substring(2,n),r._path=t.substring(n))}else r._path=t;return r._path[0]!==e._slash&&(r._path=e._slash+r._path),e._validate(r),r},e._parseComponents=function(t){var r={scheme:e._empty,authority:e._empty,path:e._empty,query:e._empty,fragment:e._empty},n=e._regexp.exec(t);return n&&(r.scheme=n[2]||r.scheme,r.authority=n[4]||r.authority,r.path=n[5]||r.path,r.query=n[7]||r.query,r.fragment=n[9]||r.fragment),r},e.from=function(t){return(new e).with(t)},e._validate=function(t){if(t.scheme&&!e._schemePattern.test(t.scheme))throw new Error("[UriError]: Scheme contains illegal characters.");if(t.path)if(t.authority){if(!e._singleSlashStart.test(t.path))throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character')}else if(e._doubleSlashStart.test(t.path))throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")')},e.prototype.toString=function(t){return void 0===t&&(t=!1),t?e._asFormatted(this,!0):(this._formatted||(this._formatted=e._asFormatted(this,!1)),this._formatted)},e._asFormatted=function(t,r){var i=r?o:n,a=[],s=t.scheme,u=t.authority,l=t.path,c=t.query,f=t.fragment;if(s&&a.push(s,":"),(u||"file"===s)&&a.push("//"),u&&(-1===(h=(u=u.toLowerCase()).indexOf(":"))?a.push(i(u)):a.push(i(u.substr(0,h)),u.substr(h))),l){var p=e._upperCaseDrive.exec(l);p&&(l=p[1]?"/"+p[2].toLowerCase()+l.substr(3):p[2].toLowerCase()+l.substr(2));for(var d=0;;){var h;if(-1===(h=l.indexOf(e._slash,d))){a.push(i(l.substring(d)));break}a.push(i(l.substring(d,h)),e._slash),d=h+1}}return c&&a.push("?",i(c)),f&&a.push("#",i(f)),a.join(e._empty)},e.prototype.toJSON=function(){var e={fsPath:this.fsPath,external:this.toString(),$mid:1};return this.path&&(e.path=this.path),this.scheme&&(e.scheme=this.scheme),this.authority&&(e.authority=this.authority),this.query&&(e.query=this.query),this.fragment&&(e.fragment=this.fragment),e},e.revive=function(t){var r=new e;return r._scheme=t.scheme||e._empty,r._authority=t.authority||e._empty,r._path=t.path||e._empty,r._query=t.query||e._empty,r._fragment=t.fragment||e._empty,r._fsPath=t.fsPath,r._formatted=t.external,e._validate(r),r},e}();if(a._empty="",a._slash="/",a._regexp=/^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,a._driveLetterPath=/^\/[a-zA-z]:/,a._upperCaseDrive=/^(\/)?([A-Z]:)/,a._schemePattern=/^\w[\w\d+.-]*$/,a._singleSlashStart=/^\//,a._doubleSlashStart=/^\/\//,t.default=a,"object"==typeof process)i="win32"===process.platform;else if("object"==typeof navigator){var s=navigator.userAgent;i=s.indexOf("Windows")>=0}}(0,We.exports))&&(Le.exports=Be);for(var qe={},ze={quote:function(e){return e.map((function(e){return e&&"object"==typeof e?e.op.replace(/(.)/g,"\\$1"):/["\s]/.test(e)&&!/'/.test(e)?"'"+e.replace(/(['\\])/g,"\\$1")+"'":/["'\s]/.test(e)?'"'+e.replace(/(["\\$`!])/g,"\\$1")+'"':String(e).replace(/([#!"$&'()*,:;<=>?@\[\\\]^`{|}])/g,"\\$1")})).join(" ")}},Ve="(?:"+["\\|\\|","\\&\\&",";;","\\|\\&","[&;()|<>]"].join("|")+")",He="(\\\\['\"|&;()<> \\t]|[^\\s'\"|&;()<> \\t])+",Ge="",Ke=0;Ke<4;Ke++)Ge+=(Math.pow(16,8)*Math.random()).toString(16);ze.parse=function(e,t,r){var n=function(e,t,r){var n=new RegExp(["("+Ve+")","("+He+"|\"((\\\\\"|[^\"])*?)\"|'((\\\\'|[^'])*?)')*"].join("|"),"g"),o=e.match(n).filter(Boolean),i=!1;if(!o)return[];t||(t={});r||(r={});return o.map((function(e,t){if(!i){if("#"===e.charAt(0))return i=!0,{comment:e.substr(1)+o.slice(t+1).join(" ")};if(RegExp("^"+Ve+"$").test(e))return{op:e};for(var n="'",s='"',u="$",l=r.escape||"\\",c=!1,f=!1,p="",d=!1,h=0,m=e.length;h<m;h++){var g=e.charAt(h);if(d=d||!c&&("*"===g||"?"===g),f)p+=g,f=!1;else if(c)g===c?c=!1:c==n?p+=g:g===l?(h+=1,p+=(g=e.charAt(h))===s||g===l||g===u?g:l+g):p+=g===u?b():g;else if(g===s||g===n)c=g;else{if(RegExp("^"+Ve+"$").test(g))return{op:e};g===l?f=!0:p+=g===u?b():g}}return d?{op:"glob",pattern:p}:p}function b(){var t,r;if(h+=1,"{"===e.charAt(h)){if(h+=1,"}"===e.charAt(h))throw new Error("Bad substitution: "+e.substr(h-2,3));if((t=e.indexOf("}",h))<0)throw new Error("Bad substitution: "+e.substr(h));r=e.substr(h,t-h),h=t}else/[*@#?$!_\-]/.test(e.charAt(h))?(r=e.charAt(h),h+=1):(t=e.substr(h).match(/[^\w\d_]/))?(r=e.substr(h,t.index),h+=t.index-1):(r=e.substr(h),h=e.length);return a(null,"",r)}})).reduce((function(e,t){return void 0===t?e:e.concat(t)}),[]);function a(e,r,n){var o="function"==typeof t?t(n):t[n];return void 0===o&&(o=""),"object"==typeof o?r+Ge+JSON.stringify(o)+Ge:r+o}}(e,t,r);return"function"!=typeof t?n:n.reduce((function(e,t){if("object"==typeof t)return e.concat(t);var r=t.split(RegExp("("+Ge+".*?"+Ge+")","g"));return 1===r.length?e.concat(r[0]):e.concat(r.filter(Boolean).map((function(e){return RegExp("^"+Ge).test(e)?JSON.parse(e.split(Ge)[1]):e})))}),[])},Object.defineProperty(qe,"__esModule",{value:!0}),qe.stringifyError=function(e){return`name: ${e.name}, message: ${e.message}, stack: ${e.stack}.`},qe.maybeToString=function(e){return String(e)},qe.relativeDate=function(e,t,r=!1,n=!1){let o=e,i=t;o instanceof Date&&(o=o.getTime());i||(i=(new Date).getTime());i instanceof Date&&(i=i.getTime());const a=i-o,s=r?rt:n?ot:nt;for(const[e,t,n]of s)if(a<e)return"number"==typeof n?Math.round(a/n)+(r?"":" ")+t:t;throw new Error("This should never be reached.")},qe.countOccurrences=function(e,t){(0,Xe.default)(1===t.length,"char must be a string of length 1");let r=0;const n=t.charCodeAt(0);for(let t=0;t<e.length;t++)e.charCodeAt(t)===n&&r++;return r},qe.shellParse=function(e,t){const r=(0,Ye.parse)(e,t);for(let e=0;e<r.length;e++)if("string"!=typeof r[e])throw null!=r[e].op?new Error(`Unexpected operator "${r[e].op}" provided to shellParse`):new Error(`Unexpected comment "${r[e].comment}" provided to shellParse`);return r},qe.shellParseWithGlobs=function(e,t){const r=(0,Ye.parse)(e,t);for(let e=0;e<r.length;e++)if("string"!=typeof r[e]){if("glob"!==r[e].op)throw null!=r[e].op?new Error(`Unexpected operator "${r[e].op}" provided to shellParse`):new Error(`Unexpected comment "${r[e].comment}" provided to shellParse`);r[e]=r[e].pattern}return r},qe.shellQuote=function(e){return(0,Ye.quote)(e)},qe.removeCommonPrefix=function(e,t){let r=0;for(;e[r]===t[r]&&r<e.length&&r<t.length;)r++;return[e.substring(r),t.substring(r)]},qe.removeCommonSuffix=function(e,t){let r=0;for(;e[e.length-1-r]===t[t.length-1-r]&&r<e.length&&r<t.length;)r++;return[e.substring(0,e.length-r),t.substring(0,t.length-r)]},qe.shorten=function(e,t,r){return e.length<t?e:e.slice(0,t)+(r||"")},qe.splitOnce=function(e,t){const r=e.indexOf(t);return-1===r?[e,null]:[e.slice(0,r),e.slice(r+t.length)]},qe.indent=function(e,t=2,r=" "){return e.replace(/^([^\n])/gm,r.repeat(t)+"$1")},qe.pluralize=function(e,t){return 1===t?e:e+"s"},qe.capitalize=function(e){return 0===e.length?e:e.charAt(0).toUpperCase().concat(e.slice(1))},qe.getMatchRanges=function(e,t){if(""===t)return[];const r=[];let n=0;for(;-1!==(n=e.indexOf(t,n));){const e=r[r.length-1];null!=e&&e[1]===n?e[1]+=t.length:r.push([n,n+t.length]),n+=t.length}return r},qe.escapeMarkdown=function(e){return e.replace(/[#!()*+\-.[\\\]_`{}]/g,"\\$&").replace(/</g,"&lt;").replace(/>/g,"&gt;")},qe.ZERO_WIDTH_SPACE=qe.ELLIPSIS_CHAR=qe.URL_REGEX=void 0;var Xe=function(e){return e&&e.__esModule?e:{default:e}}(u.default),Ye=ze;const Ze=36e5,Je=24*Ze,Qe=7*Je,et=365*Je,tt=et/12,rt=[[42e3,"now"],[9e4,"1m"],[36e5,"m",6e4],[54e5,"1h"],[Je,"h",Ze],[2*Je,"1d"],[7*Je,"d",Je],[1.5*Qe,"1w"],[tt,"w",Qe],[1.5*tt,"1mo"],[et,"mo",tt],[1.5*et,"1y"],[Number.MAX_VALUE,"y",et]],nt=[[42e3,"just now"],[9e4,"a minute ago"],[36e5,"minutes ago",6e4],[54e5,"an hour ago"],[Je,"hours ago",Ze],[2*Je,"yesterday"],[7*Je,"days ago",Je],[1.5*Qe,"a week ago"],[tt,"weeks ago",Qe],[1.5*tt,"a month ago"],[et,"months ago",tt],[1.5*et,"a year ago"],[Number.MAX_VALUE,"years ago",et]],ot=[[42e3,"just now"],[9e4,"1 minute ago"],[36e5,"minutes ago",6e4],[54e5,"1 hour ago"],[Je,"hours ago",Ze],[2*Je,"yesterday"],[7*Je,"days ago",Je],[1.5*Qe,"1 week ago"],[tt,"weeks ago",Qe],[1.5*tt,"1 month ago"],[et,"months ago",tt],[1.5*et,"1 year ago"],[Number.MAX_VALUE,"years ago",et]];qe.URL_REGEX=/(https?:\/\/(?:www\.)?[-\w@:%.+~#=]{2,256}\.[a-z]{2,6}\b[-\w@:%+.~#?&/=!]*|www\.[-\w@:%.+~#=]{2,256}\.[a-z]{2,6}\b[-\w@:%+.~#?&/=!]*)/;qe.ELLIPSIS_CHAR="…";qe.ZERO_WIDTH_SPACE="​",Object.defineProperty($e,"__esModule",{value:!0}),$e.__TEST__=Vt=$e.default=void 0;var it=ct(We.exports),at=ct(u.default),st=ct(f.default),ut=ct(p.default),lt=qe;function ct(e){return e&&e.__esModule?e:{default:e}}const ft=[],pt=/^[A-Za-z0-9_-]+:\/\/.*/;function dt(e){return e.startsWith("nuclide://")}function ht(e){return e.startsWith("atom://")}function mt(e,t){return(0,at.default)(null!=t&&""!==t,"NuclideUri must include a path."),`nuclide://${e}${t}`}function gt(e){if(e.startsWith("nuclide://")){const t=e.substr("nuclide://".length),r=t.indexOf("/");(0,at.default)(-1!==r,`Remote URIs must contain a hostname and a path. Failed to parse ${e}`);const n=t.substr(0,r);(0,at.default)(""!==n,`Remote URIs must contain a hostname. Failed to parse ${e}`);const o=t.substr(r);return(0,at.default)(!Bt(e),`Path cannot end with archive separator. Failed to parse ${e}`),{hostname:n,path:o}}return(0,at.default)(!Bt(e),`Path cannot end with archive separator. Failed to parse ${e}`),{hostname:null,path:e}}function bt(e){if(!dt(e))throw new Error("Expected remote uri. Got "+e);const t=gt(e);return(0,at.default)(t.hostname,`Remote Nuclide URIs must contain hostnames, '${(0,lt.maybeToString)(t.hostname)}' found while parsing '${e}'`),{hostname:t.hostname,path:t.path}}function yt(e){return gt(e).path}function vt(e){return bt(e).hostname}function _t(e,...t){return wt(e,t)}function wt(e,t){Wt(e);const r=Dt(e);if(dt(e)){const{hostname:n,path:o}=bt(e);return t.splice(0,0,o),Nt(r,t),Ft(r,mt(n,r.join.apply(null,t)))}return t.splice(0,0,e),Nt(r,t),Ft(r,r.join.apply(null,t))}function Et(e){Wt(e);const t=Dt(e);if(dt(e)){const{hostname:r,path:n}=bt(e);return mt(r,Ft(t,t.normalize(Ut(t,n))))}return Ft(t,t.normalize(Ut(t,e)))}function Ot(e,t=""){Wt(e);const r=Dt(e);return Ft(r,r.basename(Ut(r,yt(e)),t))}function Pt(e){Wt(e);const t=Dt(e);if(dt(e)){const{hostname:r,path:n}=bt(e);return mt(r,Ft(t,t.dirname(Ut(t,n))))}return Ft(t,t.dirname(Ut(t,e)))}function Tt(e){Wt(e);const t=Dt(e);return Ft(t,t.extname(Ut(t,yt(e))))}function xt(e){const t="file://";if(!e.startsWith(t))return null;const r=e.substr(t.length);return function(e){return Dt(e)===st.default.win32}(r)?r:null}function St(e,t){if(Wt(e),Wt(t),t.length<e.length)return!(t.length<e.length-1)&&(e.startsWith(t)&&(It(e)||$t(t,e.length)));if(!t.startsWith(e))return!1;if(It(e)||e.length===t.length)return!0;const r=Dt(t);return $t(t,e.length)||t.slice(e.length).startsWith(r.sep)}const Rt=[];function At(e){return Rt.reduce(((e,t)=>{const r=t(e);return null!=r&&""!==r?r:e}),e)}function jt(e){return Wt(e),dt(e)?At(vt(e)):e}function Mt(e){Wt(e);const t=Dt(e);return e.endsWith(t.sep)?e:e+t.sep}function It(e){Wt(e);const t=Dt(e);return e.endsWith(t.sep)}function kt(e){if(Wt(e),dt(e))return!0;return Dt(e).isAbsolute(e)}function Ct(e){return Wt(e),Pt(e)===e}function Dt(e){return(0,at.default)(!Bt(e),`Path cannot end with archive separator. Failed to determine path module for ${e}`),e.startsWith(st.default.posix.sep)||e.indexOf("://")>-1?st.default.posix:":"===e[1]&&e[2]===st.default.win32.sep||e.split(st.default.win32.sep).length>e.split(st.default.posix.sep).length?st.default.win32:st.default.posix}function Nt(e,t){return t.forEach(((t,r,n)=>n[r]=Ut(e,t))),t}function Ut(e,t){return t.indexOf("!")<0?t:ft.reduce(((t,r)=>t.replace(`${r}!`,`${r}!${e.sep}`)),t)}function Ft(e,t){return t.indexOf("!")<0?t:Bt(r=ft.reduce(((t,r)=>t.replace(`${r}!${e.sep}`,`${r}!`)),t))?r.substring(0,r.length-"!".length):r;var r}function Lt(e,t){return e.length<t.length&&t.startsWith(e)&&$t(t,e.length)?e+"!":e}function Bt(e){return $t(e,e.length-1)}function $t(e,t){return e.length>t&&"!"===e.charAt(t)&&ft.some((r=>{const n=t-r.length;return e.indexOf(r,n)===n}))}function Wt(e){if(null!=e&&Bt(e))throw new Error(`Path operation invoked on URI ending with !: ${e}`)}const qt=new Set([".bmp",".gif",".ico",".jpeg",".jpg",".png",".webp"]);var zt={basename:Ot,dirname:Pt,extname:Tt,stripExtension:function(e){Wt(e);const t=Tt(e);return 0===t.length?e:e.slice(0,-1*t.length)},isRemote:dt,isLocal:function(e){return!dt(e)&&!function(e){return pt.test(e)}(e)&&!ht(e)},createRemoteUri:mt,isInArchive:function(e){if(ht(e)||e.indexOf("!")<0)return!1;for(let t=e.indexOf("!");t>=0;t=e.indexOf("!",t+1))if($t(e,t))return!0;return!1},ancestorOutsideArchive:function(e){for(let t=e.indexOf("!");t>=0;t=e.indexOf("!",t+1))if($t(e,t))return e.substring(0,t);return e},parse:gt,parseRemoteUri:bt,validate:function(e,t){(0,at.default)(null!=e,"Unexpected null NuclideUri"),(0,at.default)("string"==typeof e,`Unexpected NuclideUri type: ${String(e)}`),dt(e)?(gt(e),(0,at.default)(!1!==t,"Expected remote NuclideUri")):((0,at.default)(""!==e,"NuclideUri must contain a non-empty path"),(0,at.default)(!0!==t,"Expected local NuclideUri"))},getPath:yt,getHostname:vt,getHostnameOpt:function(e){return null!=e&&dt(e)?vt(e):null},join:_t,joinArray:wt,archiveJoin:function(e,t){if(Wt(e),!ft.some((t=>e.endsWith(t))))throw new Error(`Cannot archiveJoin with non-archive ${e} and ${t}`);return e+"!"+t},relative:function(e,t){Wt(e);const r=Dt(e),n=dt(e);if(n!==dt(t)||n&&vt(e)!==vt(t))throw new Error(`Cannot relative urls on different hosts: ${e} and ${t}`);const o=Ut(r,n?yt(e):e),i=Ut(r,n?yt(t):t);return Ft(r,r.relative(Lt(o,i),Lt(i,o)))},looksLikeImageUri:function(e){const t=Tt(e).toLowerCase();return qt.has(t)},normalize:Et,normalizeDir:function(e){return Mt(Et(e))},getParent:function(e){return Et(_t(e,".."))},uriToNuclideUri:function(e){const t=xt(e);if(null!=t)return t;const r=it.default.parse(e);return"file"===r.scheme&&r.path?r.fsPath:dt(e)?e:null},nuclideUriToUri:function(e){return Wt(e),dt(e)?e:it.default.file(e).toString()},contains:St,collapse:function(e){return e.filter((t=>!e.some((e=>St(e,t)&&e!==t))))},nuclideUriToDisplayString:function(e){return Wt(e),dt(e)?`${jt(e)}:${yt(e)}`:e},nuclideUriToDisplayHostname:jt,hostnameToDisplayHostname:At,registerHostnameFormatter:function(e){return Rt.push(e),{dispose:()=>{const t=Rt.indexOf(e);t>=0&&Rt.splice(t,1)}}},ensureTrailingSeparator:Mt,trimTrailingSeparator:function(e){Wt(e);const t=Dt(e);let r=e;for(;r.endsWith(t.sep)&&!Ct(r);)r=r.slice(0,-1*t.sep.length);return r},endsWithSeparator:It,endsWithEdenDir:function(e){return Wt(e),e.endsWith(".eden")},isAbsolute:kt,isHomeRelative:function(e){return Wt(e),e.startsWith("~")},resolve:function(e,...t){Wt(e);const r=Dt(e);if(dt(e)){const{hostname:n,path:o}=bt(e);return t.splice(0,0,o),Nt(r,t),mt(n,Ft(r,r.resolve.apply(null,t)))}return t.splice(0,0,e),Nt(r,t),Ft(r,r.resolve.apply(null,t))},expandHomeDir:function(e){if(Wt(e),!e.startsWith("~"))return e;const{HOME:t,UserProfile:r}=process.env,n=!dt(e)&&"win32"===ut.default.platform(),o=n?r:t;return(0,at.default)(null!=o),"~"===e?o:e.startsWith("~/")||n&&e.startsWith("~\\")?st.default.resolve(o,e.replace("~",".")):e},splitPathList:function(e){(0,at.default)(e.indexOf("nuclide://")<0,"Splitting remote URIs is not supported");const t=Dt(e);return e.split(t.delimiter)},joinPathList:function(e){if(0===e.length)return"";(0,at.default)(e.every((e=>!dt(e))),"Joining of remote URIs is not supported");const t=Dt(e[0]);return e.join(t.delimiter)},ensureLocalPrefix:function(e){Wt(e);const t=Dt(e);(0,at.default)(!dt(e),"Local prefix can not be added to a remote path"),(0,at.default)(!kt(e),"Local prefix can not be added to an absolute path");const r=`.${t.sep}`;return e.startsWith(r)?e:r+e},isRoot:Ct,parsePath:function(e){Wt(e);const t=Dt(e),r=t.parse(Ut(t,yt(e)));return{root:Ft(t,r.root),dir:Ft(t,r.dir),base:Ft(t,r.base),ext:Ft(t,r.ext),name:Ft(t,r.name)}},split:function(e){const t=[];let r=e,n=Pt(r);for(;r!==n;)t.push(Ot(r)),r=n,n=Pt(r);return kt(e)&&t.push(n),t.reverse(),t},pathSeparatorFor:function(e){return Dt(e).sep},hasKnownArchiveExtension:function(e){return ft.some((t=>e.endsWith(t)))},ARCHIVE_SEPARATOR:"!",KNOWN_ARCHIVE_EXTENSIONS:ft,NUCLIDE_URI_TYPE_NAME:"NuclideUri"},Vt=$e.default=zt;const Ht={_pathModuleFor:Dt};$e.__TEST__=Ht;var Gt={},Kt={exports:{}},Xt={exports:{}},Yt={};!function(e){function t(e,t){return`${t&&t.context?t.context:"Value"} ${e}.`}function r(e){return o(Math.trunc(e))}function n(e){return e<0?-1:1}function o(e){return 0===e?0:e}function i(e,i){const a=!i.unsigned;let s,u;64===e?(u=Math.pow(2,53)-1,s=a?1-Math.pow(2,53):0):a?(s=-Math.pow(2,e-1),u=Math.pow(2,e-1)-1):(s=0,u=Math.pow(2,e)-1);const l=Math.pow(2,e),c=Math.pow(2,e-1);return(e,i)=>{void 0===i&&(i={});let f=+e;if(f=o(f),i.enforceRange){if(!Number.isFinite(f))throw new TypeError(t("is not a finite number",i));if(f=r(f),f<s||f>u)throw new TypeError(t(`is outside the accepted range of ${s} to ${u}, inclusive`,i));return f}return!Number.isNaN(f)&&i.clamp?(f=Math.min(Math.max(f,s),u),f=function(e){return o(e>0&&e%1==.5&&0==(1&e)||e<0&&e%1==-.5&&1==(1&e)?Math.floor(e):Math.round(e))}(f),f):Number.isFinite(f)&&0!==f?(f=r(f),f>=s&&f<=u?f:(f=function(e,t){const r=e%t;return n(t)!==n(r)?r+t:r}(f,l),a&&f>=c?f-l:f)):0}}function a(e,r){if("function"!=typeof e)throw new TypeError(t("is not a function",r));return e}e.any=e=>e,e.void=function(){},e.boolean=function(e){return!!e},e.byte=i(8,{unsigned:!1}),e.octet=i(8,{unsigned:!0}),e.short=i(16,{unsigned:!1}),e["unsigned short"]=i(16,{unsigned:!0}),e.long=i(32,{unsigned:!1}),e["unsigned long"]=i(32,{unsigned:!0}),e["long long"]=i(64,{unsigned:!1}),e["unsigned long long"]=i(64,{unsigned:!0}),e.double=(e,r)=>{const n=+e;if(!Number.isFinite(n))throw new TypeError(t("is not a finite floating-point value",r));return n},e["unrestricted double"]=e=>+e,e.float=(e,r)=>{const n=+e;if(!Number.isFinite(n))throw new TypeError(t("is not a finite floating-point value",r));if(Object.is(n,-0))return n;const o=Math.fround(n);if(!Number.isFinite(o))throw new TypeError(t("is outside the range of a single-precision floating-point value",r));return o},e["unrestricted float"]=e=>{const t=+e;return isNaN(t)||Object.is(t,-0)?t:Math.fround(t)},e.DOMString=function(e,r){if(void 0===r&&(r={}),r.treatNullAsEmptyString&&null===e)return"";if("symbol"==typeof e)throw new TypeError(t("is a symbol, which cannot be converted to a string",r));return String(e)},e.ByteString=(r,n)=>{const o=e.DOMString(r,n);let i;for(let e=0;void 0!==(i=o.codePointAt(e));++e)if(i>255)throw new TypeError(t("is not a valid ByteString",n));return o},e.USVString=(t,r)=>{const n=e.DOMString(t,r),o=n.length,i=[];for(let e=0;e<o;++e){const t=n.charCodeAt(e);if(t<55296||t>57343)i.push(String.fromCodePoint(t));else if(56320<=t&&t<=57343)i.push(String.fromCodePoint(65533));else if(e===o-1)i.push(String.fromCodePoint(65533));else{const r=n.charCodeAt(e+1);if(56320<=r&&r<=57343){const n=1023&t,o=1023&r;i.push(String.fromCodePoint(65536+1024*n+o)),++e}else i.push(String.fromCodePoint(65533))}}return i.join("")},e.object=(e,r)=>{if("Object"!==function(e){if(null===e)return"Null";switch(typeof e){case"undefined":return"Undefined";case"boolean":return"Boolean";case"number":return"Number";case"string":return"String";case"symbol":return"Symbol";case"object":case"function":default:return"Object"}}(e))throw new TypeError(t("is not an object",r));return e},[Error,ArrayBuffer,DataView,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array,Uint8ClampedArray,Float32Array,Float64Array].forEach((r=>{const n=r.name,o=/^[AEIOU]/.test(n)?"an":"a";e[n]=(e,i)=>{if(!(e instanceof r))throw new TypeError(t(`is not ${o} ${n} object`,i));return e}})),e.ArrayBufferView=(e,r)=>{if(!ArrayBuffer.isView(e))throw new TypeError(t("is not a view on an ArrayBuffer object",r));return e},e.BufferSource=(e,r)=>{if(!(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))throw new TypeError(t("is not an ArrayBuffer object or a view on one",r));return e},e.DOMTimeStamp=e["unsigned long long"],e.Function=a,e.VoidFunction=a}(Yt);var Zt={exports:{}};!function(e,t){function r(e){return Object.getPrototypeOf(e)===Buffer.prototype?e:e instanceof ArrayBuffer?Buffer.from(e):Buffer.from(e.buffer,e.byteOffset,e.byteLength)}const n=Symbol("wrapper"),o=Symbol("impl"),i=Symbol("SameObject caches");function a(e){return e?e[n]:null}function s(e){return e?e[o]:null}const u=Symbol("internal"),l=Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]()));e.exports={isObject:function(e){return"object"==typeof e&&null!==e||"function"==typeof e},getReferenceToBytes:r,getCopyToBytes:function(e){return Buffer.from(r(e))},mixin:function(e,t){const r=Object.getOwnPropertyNames(t);for(let n=0;n<r.length;++n)r[n]in e||Object.defineProperty(e,r[n],Object.getOwnPropertyDescriptor(t,r[n]))},wrapperSymbol:n,implSymbol:o,getSameObject:function(e,t,r){return e[i]||(e[i]=Object.create(null)),t in e[i]||(e[i][t]=r()),e[i][t]},wrapperForImpl:a,implForWrapper:s,tryWrapperForImpl:function(e){const t=a(e);return t||e},tryImplForWrapper:function(e){const t=s(e);return t||e},iterInternalSymbol:u,IteratorPrototype:l}}(Zt);var Jt={};const Qt={IndexSizeError:1,DOMStringSizeError:2,HierarchyRequestError:3,WrongDocumentError:4,InvalidCharacterError:5,NoDataAllowedError:6,NoModificationAllowedError:7,NotFoundError:8,NotSupportedError:9,InUseAttributeError:10,InvalidStateError:11,SyntaxError:12,InvalidModificationError:13,NamespaceError:14,InvalidAccessError:15,ValidationError:16,TypeMismatchError:17,SecurityError:18,NetworkError:19,AbortError:20,URLMismatchError:21,QuotaExceededError:22,TimeoutError:23,InvalidNodeTypeError:24,DataCloneError:25},er=Zt.exports;Jt.implementation=class{constructor([e,t]){this.name=t,this.message=e}get code(){return Qt[this.name]||0}},Jt.init=e=>{if(Error.captureStackTrace){const t=er.wrapperForImpl(e);Error.captureStackTrace(t,t.constructor)}},function(e){const t=Yt,r=Zt.exports,n=r.implSymbol;function o(){const e=[];for(let t=0;t<arguments.length&&t<2;++t)e[t]=arguments[t];void 0!==e[0]?e[0]=t.DOMString(e[0],{context:"Failed to construct 'DOMException': parameter 1"}):e[0]="",void 0!==e[1]?e[1]=t.DOMString(e[1],{context:"Failed to construct 'DOMException': parameter 2"}):e[1]="Error",i.setup(this,e)}Object.defineProperty(o,"prototype",{value:o.prototype,writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(o.prototype,"name",{get(){return this[n].name},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"message",{get(){return this[n].message},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"code",{get(){return this[n].code},enumerable:!0,configurable:!0}),Object.defineProperty(o,"INDEX_SIZE_ERR",{value:1,enumerable:!0}),Object.defineProperty(o.prototype,"INDEX_SIZE_ERR",{value:1,enumerable:!0}),Object.defineProperty(o,"DOMSTRING_SIZE_ERR",{value:2,enumerable:!0}),Object.defineProperty(o.prototype,"DOMSTRING_SIZE_ERR",{value:2,enumerable:!0}),Object.defineProperty(o,"HIERARCHY_REQUEST_ERR",{value:3,enumerable:!0}),Object.defineProperty(o.prototype,"HIERARCHY_REQUEST_ERR",{value:3,enumerable:!0}),Object.defineProperty(o,"WRONG_DOCUMENT_ERR",{value:4,enumerable:!0}),Object.defineProperty(o.prototype,"WRONG_DOCUMENT_ERR",{value:4,enumerable:!0}),Object.defineProperty(o,"INVALID_CHARACTER_ERR",{value:5,enumerable:!0}),Object.defineProperty(o.prototype,"INVALID_CHARACTER_ERR",{value:5,enumerable:!0}),Object.defineProperty(o,"NO_DATA_ALLOWED_ERR",{value:6,enumerable:!0}),Object.defineProperty(o.prototype,"NO_DATA_ALLOWED_ERR",{value:6,enumerable:!0}),Object.defineProperty(o,"NO_MODIFICATION_ALLOWED_ERR",{value:7,enumerable:!0}),Object.defineProperty(o.prototype,"NO_MODIFICATION_ALLOWED_ERR",{value:7,enumerable:!0}),Object.defineProperty(o,"NOT_FOUND_ERR",{value:8,enumerable:!0}),Object.defineProperty(o.prototype,"NOT_FOUND_ERR",{value:8,enumerable:!0}),Object.defineProperty(o,"NOT_SUPPORTED_ERR",{value:9,enumerable:!0}),Object.defineProperty(o.prototype,"NOT_SUPPORTED_ERR",{value:9,enumerable:!0}),Object.defineProperty(o,"INUSE_ATTRIBUTE_ERR",{value:10,enumerable:!0}),Object.defineProperty(o.prototype,"INUSE_ATTRIBUTE_ERR",{value:10,enumerable:!0}),Object.defineProperty(o,"INVALID_STATE_ERR",{value:11,enumerable:!0}),Object.defineProperty(o.prototype,"INVALID_STATE_ERR",{value:11,enumerable:!0}),Object.defineProperty(o,"SYNTAX_ERR",{value:12,enumerable:!0}),Object.defineProperty(o.prototype,"SYNTAX_ERR",{value:12,enumerable:!0}),Object.defineProperty(o,"INVALID_MODIFICATION_ERR",{value:13,enumerable:!0}),Object.defineProperty(o.prototype,"INVALID_MODIFICATION_ERR",{value:13,enumerable:!0}),Object.defineProperty(o,"NAMESPACE_ERR",{value:14,enumerable:!0}),Object.defineProperty(o.prototype,"NAMESPACE_ERR",{value:14,enumerable:!0}),Object.defineProperty(o,"INVALID_ACCESS_ERR",{value:15,enumerable:!0}),Object.defineProperty(o.prototype,"INVALID_ACCESS_ERR",{value:15,enumerable:!0}),Object.defineProperty(o,"VALIDATION_ERR",{value:16,enumerable:!0}),Object.defineProperty(o.prototype,"VALIDATION_ERR",{value:16,enumerable:!0}),Object.defineProperty(o,"TYPE_MISMATCH_ERR",{value:17,enumerable:!0}),Object.defineProperty(o.prototype,"TYPE_MISMATCH_ERR",{value:17,enumerable:!0}),Object.defineProperty(o,"SECURITY_ERR",{value:18,enumerable:!0}),Object.defineProperty(o.prototype,"SECURITY_ERR",{value:18,enumerable:!0}),Object.defineProperty(o,"NETWORK_ERR",{value:19,enumerable:!0}),Object.defineProperty(o.prototype,"NETWORK_ERR",{value:19,enumerable:!0}),Object.defineProperty(o,"ABORT_ERR",{value:20,enumerable:!0}),Object.defineProperty(o.prototype,"ABORT_ERR",{value:20,enumerable:!0}),Object.defineProperty(o,"URL_MISMATCH_ERR",{value:21,enumerable:!0}),Object.defineProperty(o.prototype,"URL_MISMATCH_ERR",{value:21,enumerable:!0}),Object.defineProperty(o,"QUOTA_EXCEEDED_ERR",{value:22,enumerable:!0}),Object.defineProperty(o.prototype,"QUOTA_EXCEEDED_ERR",{value:22,enumerable:!0}),Object.defineProperty(o,"TIMEOUT_ERR",{value:23,enumerable:!0}),Object.defineProperty(o.prototype,"TIMEOUT_ERR",{value:23,enumerable:!0}),Object.defineProperty(o,"INVALID_NODE_TYPE_ERR",{value:24,enumerable:!0}),Object.defineProperty(o.prototype,"INVALID_NODE_TYPE_ERR",{value:24,enumerable:!0}),Object.defineProperty(o,"DATA_CLONE_ERR",{value:25,enumerable:!0}),Object.defineProperty(o.prototype,"DATA_CLONE_ERR",{value:25,enumerable:!0}),Object.defineProperty(o.prototype,Symbol.toStringTag,{value:"DOMException",writable:!1,enumerable:!1,configurable:!0});const i={mixedInto:[],is(t){if(t){if(t[n]instanceof a.implementation)return!0;for(let r=0;r<e.exports.mixedInto.length;++r)if(t instanceof e.exports.mixedInto[r])return!0}return!1},isImpl(t){if(t){if(t instanceof a.implementation)return!0;const n=r.wrapperForImpl(t);for(let t=0;t<e.exports.mixedInto.length;++t)if(n instanceof e.exports.mixedInto[t])return!0}return!1},convert(t,{context:n="The provided value"}={}){if(e.exports.is(t))return r.implForWrapper(t);throw new TypeError(`${n} is not of type 'DOMException'.`)},create(e,t){let r=Object.create(o.prototype);return this.setup(r,e,t),r},createImpl(e,t){let n=Object.create(o.prototype);return this.setup(n,e,t),r.implForWrapper(n)},_internalSetup(e){},setup(e,t,o){o||(o={}),o.wrapper=e,this._internalSetup(e),Object.defineProperty(e,n,{value:new a.implementation(t,o),writable:!1,enumerable:!1,configurable:!0}),e[n][r.wrapperSymbol]=e,a.init&&a.init(e[n],o)},interface:o,expose:{Window:{DOMException:o},Worker:{DOMException:o}}};e.exports=i;const a=Jt}(Xt),function(e){e.exports=Xt.exports.interface,Object.setPrototypeOf(e.exports.prototype,Error.prototype)}(Kt);var tr={},rr={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const r=new WeakMap,n=new WeakMap;function o(e){const t=r.get(e);return console.assert(null!=t,"'this' is expected an Event object, but got",e),t}function i(e,t){r.set(this,{eventTarget:e,event:t,eventPhase:2,currentTarget:e,canceled:!1,stopped:!1,passiveListener:null,timeStamp:t.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});const n=Object.keys(t);for(let e=0;e<n.length;++e){const t=n[e];t in this||Object.defineProperty(this,t,a(t))}}function a(e){return{get(){return o(this).event[e]},set(t){o(this).event[e]=t},configurable:!0,enumerable:!0}}function s(e){return{value(){const t=o(this).event;return t[e].apply(t,arguments)},configurable:!0,enumerable:!0}}function u(e){if(null==e||e===Object.prototype)return i;let t=n.get(e);return null==t&&(t=function(e,t){const r=Object.keys(t);if(0===r.length)return e;function n(t,r){e.call(this,t,r)}n.prototype=Object.create(e.prototype,{constructor:{value:n,configurable:!0,writable:!0}});for(let o=0;o<r.length;++o){const i=r[o];if(!(i in e.prototype)){const e="function"==typeof Object.getOwnPropertyDescriptor(t,i).value;Object.defineProperty(n.prototype,i,e?s(i):a(i))}}return n}(u(Object.getPrototypeOf(e)),e),n.set(e,t)),t}function l(e){return o(e).stopped}function c(e,t){o(e).passiveListener=t}i.prototype={get type(){return o(this).event.type},get target(){return o(this).eventTarget},get currentTarget(){return o(this).currentTarget},composedPath(){const e=o(this).currentTarget;return null==e?[]:[e]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return o(this).eventPhase},stopPropagation(){const e=o(this);"function"==typeof e.event.stopPropagation&&e.event.stopPropagation()},stopImmediatePropagation(){const e=o(this);e.stopped=!0,"function"==typeof e.event.stopImmediatePropagation&&e.event.stopImmediatePropagation()},get bubbles(){return Boolean(o(this).event.bubbles)},get cancelable(){return Boolean(o(this).event.cancelable)},preventDefault(){const e=o(this);null==e.passiveListener?e.event.cancelable&&(e.canceled=!0,"function"==typeof e.event.preventDefault&&e.event.preventDefault()):console.warn("Event#preventDefault() was called from a passive listener:",e.passiveListener)},get defaultPrevented(){return o(this).canceled},get composed(){return Boolean(o(this).event.composed)},get timeStamp(){return o(this).timeStamp}},Object.defineProperty(i.prototype,"constructor",{value:i,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.Event&&(Object.setPrototypeOf(i.prototype,window.Event.prototype),n.set(window.Event.prototype,i));const f=new WeakMap;function p(e){return null!==e&&"object"==typeof e}function d(e){const t=f.get(e);if(null==t)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return t}function h(e,t){Object.defineProperty(e,`on${t}`,function(e){return{get(){let t=d(this).get(e);for(;null!=t;){if(3===t.listenerType)return t.listener;t=t.next}return null},set(t){"function"==typeof t||p(t)||(t=null);const r=d(this);let n=null,o=r.get(e);for(;null!=o;)3===o.listenerType?null!==n?n.next=o.next:null!==o.next?r.set(e,o.next):r.delete(e):n=o,o=o.next;if(null!==t){const o={listener:t,listenerType:3,passive:!1,once:!1,next:null};null===n?r.set(e,o):n.next=o}},configurable:!0,enumerable:!0}}(t))}function m(e){function t(){g.call(this)}t.prototype=Object.create(g.prototype,{constructor:{value:t,configurable:!0,writable:!0}});for(let r=0;r<e.length;++r)h(t.prototype,e[r]);return t}function g(){if(!(this instanceof g)){if(1===arguments.length&&Array.isArray(arguments[0]))return m(arguments[0]);if(arguments.length>0){const e=new Array(arguments.length);for(let t=0;t<arguments.length;++t)e[t]=arguments[t];return m(e)}throw new TypeError("Cannot call a class as a function")}f.set(this,new Map)}g.prototype={addEventListener(e,t,r){if(null==t)return!1;if("function"!=typeof t&&!p(t))throw new TypeError("'listener' should be a function or an object.");const n=d(this),o=p(r),i=(o?Boolean(r.capture):Boolean(r))?1:2,a={listener:t,listenerType:i,passive:o&&Boolean(r.passive),once:o&&Boolean(r.once),next:null};let s=n.get(e);if(void 0===s)return n.set(e,a),!0;let u=null;for(;null!=s;){if(s.listener===t&&s.listenerType===i)return!1;u=s,s=s.next}return u.next=a,!0},removeEventListener(e,t,r){if(null==t)return!1;const n=d(this),o=(p(r)?Boolean(r.capture):Boolean(r))?1:2;let i=null,a=n.get(e);for(;null!=a;){if(a.listener===t&&a.listenerType===o)return null!==i?i.next=a.next:null!==a.next?n.set(e,a.next):n.delete(e),!0;i=a,a=a.next}return!1},dispatchEvent(e){if(null==e||"string"!=typeof e.type)throw new TypeError('"event.type" should be a string.');const t=d(this),r=e.type;let n=t.get(r);if(null==n)return!0;const i=function(e,t){return new(u(Object.getPrototypeOf(t)))(e,t)}(this,e);let a=null;for(;null!=n&&(n.once?null!==a?a.next=n.next:null!==n.next?t.set(r,n.next):t.delete(r):a=n,c(i,n.passive?n.listener:null),"function"==typeof n.listener?n.listener.call(this,i):3!==n.listenerType&&"function"==typeof n.listener.handleEvent&&n.listener.handleEvent(i),!l(i));)n=n.next;return c(i,null),function(e,t){o(e).eventPhase=t}(i,0),function(e,t){o(e).currentTarget=t}(i,null),!i.defaultPrevented}},Object.defineProperty(g.prototype,"constructor",{value:g,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.EventTarget&&Object.setPrototypeOf(g.prototype,window.EventTarget.prototype),t.defineEventAttribute=h,t.EventTarget=g,t.default=g,e.exports=g,e.exports.EventTarget=e.exports.default=g,e.exports.defineEventAttribute=h}(rr,rr.exports),Object.defineProperty(tr,"__esModule",{value:!0}),tr.default=tr.AbortSignal=void 0;var nr=rr.exports;let or,ir;or=Symbol.toStringTag;class ar extends nr.EventTarget{constructor(...e){super(...e),this.aborted=!1,this.onabort=void 0}get[or](){return"AbortSignal"}}tr.AbortSignal=ar,(0,nr.defineEventAttribute)(ar.prototype,"abort"),ir=Symbol.toStringTag;tr.default=class{constructor(){this.signal=new ar}abort(){this.signal.aborted||(this.signal.aborted=!0,this.signal.dispatchEvent({type:"abort"}))}get[ir](){return"AbortController"}};var sr={};Object.defineProperty(sr,"__esModule",{value:!0}),sr.ensureArray=function(e){return Array.isArray(e)?e:[e]},sr.arrayRemove=function(e,t){const r=e.indexOf(t);r>=0&&e.splice(r,1)},sr.arrayEqual=lr,sr.arrayCompact=function(e){const t=[];for(const r of e)null!=r&&t.push(r);return t},sr.arrayFlatten=function(e){const t=[];for(const r of e)for(const e of r)t.push(e);return t},sr.arrayUnique=function(e){return Array.from(new Set(e))},sr.arrayFindLastIndex=function(e,t,r){for(let n=e.length-1;n>=0;n--)if(t.call(r,e[n],n,e))return n;return-1},sr.findSubArrayIndex=function(e,t){return e.findIndex(((r,n)=>lr(e.slice(n,n+t.length),t)))},sr.arrayPartition=function(e,t){const r=[],n=[];return e.forEach((e=>t(e)?r.push(e):n.push(e))),[r,n]},sr.mapUnion=function(...e){const t=new Map;for(const r of e)for(const[e,n]of r)t.set(e,n);return t},sr.mapCompact=function(e){const t=new Map;for(const[r,n]of e)null!=n&&t.set(r,n);return t},sr.mapFilter=function(e,t){const r=new Map;for(const[n,o]of e)t(n,o)&&r.set(n,o);return r},sr.mapTransform=function(e,t){const r=new Map;for(const[n,o]of e)r.set(n,t(o,n));return r},sr.mapEqual=function(e,t,r){if(e.size!==t.size)return!1;const n=r||((e,t)=>e===t);for(const[r,o]of e)if(!t.has(r)||!n(o,t.get(r)))return!1;return!0},sr.mapGetWithDefault=function(e,t,r){return e.has(t)?e.get(t):r},sr.areSetsEqual=function(e,t){return e.size===t.size&&cr(e,(e=>t.has(e)))},sr.every=cr,sr.setIntersect=function(e,t){return fr(e,(e=>t.has(e)))},sr.setUnion=function(...e){if(e.length<1)return new Set;return e.reduce(((e,t)=>function(e,t){const r=new Set(e);return t.forEach((e=>{r.add(e)})),r}(e,t)))},sr.setDifference=function(e,t,r){if(0===e.size)return new Set;if(0===t.size)return new Set(e);const n=new Set,o=r||(e=>e),i=null==r?t:new Set(Array.from(t.values()).map(o));return e.forEach((e=>{i.has(o(e))||n.add(e)})),n},sr.setFilter=fr,sr.isEmpty=function(e){for(const t in e)return!1;return!0},sr.keyMirror=function(e){const t={};return Object.keys(e).forEach((e=>{t[e]=e})),t},sr.collect=function(e){const t=new Map;for(const r of e){const[e,n]=r;let o=t.get(e);null==o&&(o=[],t.set(e,o)),o.push(n)}return t},sr.objectFromPairs=function(e){const t={};for(const[r,n]of e)t[r]=n;return t},sr.objectMapValues=function(e,t){const r={};return Object.keys(e).forEach((n=>{r[n]=t(e[n],n)})),r},sr.objectValues=function(e){return Object.keys(e).map((t=>e[t]))},sr.objectEntries=pr,sr.objectFromMap=function(e){const t={};return e.forEach(((e,r)=>{t[r]=e})),t},sr.concatIterators=function*(...e){for(const t of e)for(const e of t)yield e},sr.someOfIterable=function(e,t){for(const r of e)if(t(r))return!0;return!1},sr.findInIterable=dr,sr.filterIterable=hr,sr.mapIterable=function*(e,t){for(const r of e)yield t(r)},sr.takeIterable=function*(e,t){let r=0;for(const n of e){if(++r>t)break;yield n}},sr.range=function*(e,t,r=1){(0,ur.default)(r>0);for(let n=e;n<t;n+=r)yield n},sr.firstOfIterable=function(e){return dr(e,(()=>!0))},sr.iterableIsEmpty=mr,sr.iterableContains=function(e,t){return!mr(hr(e,(e=>e===t)))},sr.count=function(e){let t=0;for(const r of e)t++;return t},sr.isIterable=function(e){return"function"==typeof e[Symbol.iterator]},sr.insideOut=function*(e,t){if(0===e.length)return;let r=null==t?Math.floor(e.length/2):Math.min(e.length,Math.max(0,t)),n=r-1;for(;r<e.length||n>=0;)r<e.length&&(yield[e[r],r],r++),n>=0&&(yield[e[n],n],n--)},sr.mapFromObject=function(e){return new Map(pr(e))},sr.lastFromArray=function(e){return e[e.length-1]},sr.distinct=function(e,t){if(null==t)return Array.from(new Set(e));const r=new Set;return e.filter((e=>{const n=t(e);return!r.has(n)&&(r.add(n),!0)}))},sr.findTopRanked=function(e,t,r){let n,o=0;for(const i of e){const e=t(i);if(e===r)return i;e>0&&e>o&&(o=e,n=i)}return n},sr.DefaultWeakMap=sr.DefaultMap=sr.MultiMap=void 0;var ur=function(e){return e&&e.__esModule?e:{default:e}}(u.default);function lr(e,t,r){if(e===t)return!0;if(e.length!==t.length)return!1;const n=r||((e,t)=>e===t);return e.every(((e,r)=>n(e,t[r])))}function cr(e,t){for(const r of e)if(!t(r))return!1;return!0}function fr(e,t){const r=new Set;for(const n of e)t(n)&&r.add(n);return r}function pr(e){if(null==e)throw new TypeError;const t=[];for(const r in e)e.hasOwnProperty(r)&&Object.prototype.propertyIsEnumerable.call(e,r)&&t.push([r,e[r]]);return t}function dr(e,t){for(const r of e)if(t(r))return r;return null}function*hr(e,t){for(const r of e)t(r)&&(yield r)}function mr(e){for(const t of e)return!1;return!0}sr.MultiMap=class{constructor(){this._map=void 0,this.size=void 0,this._map=new Map,this.size=0}get(e){const t=this._map.get(e);return null==t?new Set:t}add(e,t){let r=this._map.get(e);return null==r&&(r=new Set,this._map.set(e,r)),r.has(t)||(r.add(t),this.size++),this}set(e,t){this.deleteAll(e);const r=new Set(t);0!==r.size&&(this._map.set(e,r),this.size+=r.size)}delete(e,t){const r=this.get(e),n=r.delete(t);return 0===r.size&&this._map.delete(e),n&&this.size--,n}deleteAll(e){const t=this.get(e);return this.size-=t.size,this._map.delete(e)}clear(){this._map.clear(),this.size=0}has(e,t){return this.get(e).has(t)}hasAny(e){return this._map.has(e)}*values(){for(const e of this._map.values())yield*e}forEach(e){this._map.forEach(((t,r)=>t.forEach((t=>e(t,r,this)))))}};class gr extends Map{constructor(e,t){super(t),this._factory=void 0,this._factory=e}get(e){if(!this.has(e)){const t=this._factory(e);return this.set(e,t),t}return super.get(e)}}sr.DefaultMap=gr;class br extends WeakMap{constructor(e,t){super(t),this._factory=void 0,this._factory=e}get(e){if(!this.has(e)){const t=this._factory(e);return this.set(e,t),t}return super.get(e)}}sr.DefaultWeakMap=br;var yr={};Object.defineProperty(yr,"__esModule",{value:!0}),yr.default=function(e,t,r=!1){let n,o,i,a,s=0;const u=function(){const l=Date.now()-s;l<t&&l>=0?n=setTimeout(u,t-l):(n=null,r||((0,vr.default)(null!=o),a=e.apply(i,o),n||(i=o=null)))},l=function(...l){i=this,o=l,s=Date.now();const c=r&&!n;return n||(n=setTimeout(u,t)),c&&(a=e.apply(i,o),i=o=null),a};return l.dispose=()=>{n&&(clearTimeout(n),n=i=o=null)},l};var vr=function(e){return e&&e.__esModule?e:{default:e}}(u.default);Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.splitStream=function(e,t=!0){return Pr.Observable.create((r=>{let n="";function o(){""!==n&&(r.next(n),n="")}return e.subscribe((e=>{const o=e.split("\n");o[0]=n+o[0],n=o.pop(),t?o.forEach((e=>r.next(e+"\n"))):o.forEach((e=>r.next(e)))}),(e=>{o(),r.error(e)}),(()=>{o(),r.complete()}))}))},Gt.bufferUntil=function(e){return t=>Pr.Observable.create((r=>{let n=null;const o=()=>{null!=n&&(r.next(n),n=null)};return t.subscribe((t=>{null==n&&(n=[]),n.push(t),e(t,n)&&o()}),(e=>{o(),r.error(e)}),(()=>{o(),r.complete()}))}))},Gt.cacheWhileSubscribed=function(e){return e.multicast((()=>new Pr.ReplaySubject(1))).refCount()},Gt.diffSets=Ar,Gt.reconcileSetDiffs=jr,Gt.reconcileSets=function(e,t,r){return jr(e.let(Ar(r)),t,r)},Gt.toggle=function(e){return t=>e.distinctUntilChanged().switchMap((e=>e?t:Pr.Observable.empty()))},Gt.compact=function(e){return e.filter((e=>null!=e))},Gt.takeWhileInclusive=function(e){return t=>Pr.Observable.create((r=>t.subscribe((t=>{r.next(t),e(t)||r.complete()}),(e=>{r.error(e)}),(()=>{r.complete()}))))},Gt.concatLatest=function(...e){const t=e.map(((e,t)=>e.map((e=>[e,t]))));return Pr.Observable.merge(...t).scan(((e,[t,r])=>(e[r]=t,e)),e.map((e=>[]))).map((e=>[].concat(...e)))},Gt.throttle=function(e,t={leading:!0}){let r;switch(typeof e){case"number":r=()=>Pr.Observable.timer(e);break;case"function":r=e;break;case"object":r=()=>e;break;default:throw new Error(`Invalid delay: ${e}`)}return function(e){return Pr.Observable.create((n=>{const{leading:o=!0}=t,i=new Pr.Subject;let a=Mr,s=!1,u=!1;const l=()=>{if(!u&&a!==Mr){a=a;const e=a;u=!0,!o&&s||(a=Mr,n.next(e)),i.next(e)}},c=new Pr.Subscription;return c.add(i.switchMap((e=>{const t=r(e);return t instanceof Pr.Observable?t.take(1):t})).subscribe((()=>{u=!1,s=!1,l()}))),c.add(e.subscribe({next:e=>{a=e,s=!0,l()},error:e=>{n.error(e)},complete:()=>{a=Mr,n.complete()}})),c}))}};var _r=Gt.completingSwitchMap=function(e){const t=Symbol("completed");return r=>Pr.Observable.concat(r,Pr.Observable.of(t)).switchMap(((r,n)=>r===t?Pr.Observable.empty():e(r,n)))};Gt.mergeUntilAnyComplete=function(...e){return Pr.Observable.merge(...e.map((e=>e.materialize()))).dematerialize()},Gt.fastDebounce=function(e){return t=>Pr.Observable.create((r=>{const n=(0,Sr.default)((e=>r.next(e)),e),o=t.subscribe(n,r.error.bind(r),r.complete.bind(r));return new wr.default(o,n)}))},Gt.fromAbortablePromise=function(e){return Pr.Observable.create((t=>{let r=!1;const n=new Tr.default;return e(n.signal).then((e=>{r=!0,t.next(e),t.complete()}),(e=>{r=!0,t.error(e)})),()=>{r||n.abort()}}))},Gt.toAbortablePromise=Nr,Gt.takeUntilAbort=function(e){return t=>Pr.Observable.defer((()=>e.aborted?Pr.Observable.empty():t.takeUntil(Pr.Observable.fromEvent(e,"abort"))))},Gt.poll=function(e){return t=>Pr.Observable.defer((()=>{const r=new Pr.Subject;return r.switchMap((e=>Pr.Observable.timer(e))).merge(Pr.Observable.of(null)).switchMap((()=>{const n=Date.now();return t.do({complete:()=>{const t=Date.now()-n;r.next(Math.max(0,e-t))}})}))}))},Gt.SingletonExecutor=Gt.nextAnimationFrame=Gt.macrotask=kr=Gt.microtask=void 0;var wr=Rr(y),Er=Rr(u.default),Or=Rr(Kt.exports),Pr=s.default,Tr=Rr(tr),xr=sr,Sr=Rr(yr);function Rr(e){return e&&e.__esModule?e:{default:e}}function Ar(e){return t=>Pr.Observable.concat(Pr.Observable.of(new Set),t).pairwise().map((([t,r])=>({added:(0,xr.setDifference)(r,t,e),removed:(0,xr.setDifference)(t,r,e)}))).filter((e=>e.added.size>0||e.removed.size>0))}function jr(e,t,r){const n=r||(e=>e),o=new Map,i=e=>{const t=o.get(n(e));(0,Er.default)(null!=t),t.dispose(),o.delete(e)};return new wr.default(e.subscribe((e=>{e.added.forEach((e=>{o.set(n(e),t(e))})),e.removed.forEach(i)})),(()=>{o.forEach((e=>{e.dispose()})),o.clear()}))}const Mr={};const Ir=Pr.Observable.create((e=>{process.nextTick((()=>{e.next(),e.complete()}))}));var kr=Gt.microtask=Ir;const Cr=Pr.Observable.create((e=>{const t=setImmediate((()=>{e.next(),e.complete()}));return()=>{clearImmediate(t)}}));Gt.macrotask=Cr;const Dr=Pr.Observable.create((e=>{if("undefined"==typeof requestAnimationFrame)throw new Error("This util can only be used in Atom");const t=requestAnimationFrame((()=>{e.next(),e.complete()}));return()=>{cancelAnimationFrame(t)}}));function Nr(e,t){return null==t?e.toPromise():t.aborted?Promise.reject((0,Or.default)("Aborted","AbortError")):e.race(Pr.Observable.fromEvent(t,"abort").map((()=>{throw new Or.default("Aborted","AbortError")}))).toPromise()}Gt.nextAnimationFrame=Dr;Gt.SingletonExecutor=class{constructor(){this._abortController=null}async execute(e){this.cancel();const t=new Tr.default;this._abortController=t;try{return await Nr(e,t.signal)}finally{t===this._abortController&&(this._abortController=null)}}isExecuting(){return null!=this._abortController}cancel(){null!=this._abortController&&(this._abortController.abort(),this._abortController=null)}};class Ur{constructor(){this._subscriptions=new v(this._subscribeToEvents(),Te(this._onWillSaveProvider())),this._rangeProviders=new X,this._fileProviders=new X,this._onTypeProviders=new X,this._onSaveProviders=new X}_subscribeToEvents(){const t=ee((e=>atom.commands.add("atom-text-editor","code-format:format-code",e))).switchMap((()=>{const t=atom.workspace.getActiveTextEditor();return t?e.Observable.of({type:"command",editor:t}):e.Observable.empty()})),r=ee((e=>atom.workspace.observeTextEditors(e))).mergeMap((t=>function(t){const r=ee((e=>t.getBuffer().onDidChangeText(e))),n=ee((e=>atom.workspace.onWillDestroyPaneItem(e))).filter((e=>e.item===t));return e.Observable.merge(r.map((e=>({type:"type",editor:t,edit:e})))).takeUntil(e.Observable.merge(ne(t),n))}(t)));return e.Observable.merge(t,r).groupBy((e=>e.editor.getBuffer()),(e=>e),(e=>ee((t=>e.key.onDidDestroy(t))))).mergeMap((e=>e.let(_r((e=>this._handleEvent(e)))))).subscribe()}_handleEvent(t){const{editor:n}=t;switch(t.type){case"command":return this._formatCodeInTextEditor(n).do((e=>{ge(n.getBuffer(),e)})).map((e=>{if(!e)throw new Error("No code formatting providers found!")})).catch((t=>(atom.notifications.addError(`Failed to format code: ${t.message}`,{detail:t.detail}),e.Observable.empty())));case"type":return this._formatCodeOnTypeInTextEditor(n,t.edit).catch((t=>(r.getLogger("code-format").warn("Failed to format code on type:",t),e.Observable.empty())));default:return e.Observable.throw(`unknown event type ${t.type}`)}}_formatCodeInTextEditor(t,r){return e.Observable.defer((()=>{const o=t.getBuffer(),i=r||t.getSelectedBufferRange(),{start:a,end:s}=i;let u;u=i.isEmpty()?o.getRange():new n.Range([a.row,0],0===s.column?s:[s.row+1,0]);const l=[...this._rangeProviders.getAllProvidersForEditor(t)],c=[...this._fileProviders.getAllProvidersForEditor(t)],f=t.getText(),p=e.Observable.defer((()=>this._reportBusy(t,Promise.all(l.map((e=>e.formatCode(t,u))))))).switchMap((t=>{const r=t.find((e=>e.length>0));return null==r?e.Observable.empty():e.Observable.of(r)})),d=e.Observable.defer((()=>this._reportBusy(t,Promise.all(c.map((e=>e.formatEntireFile(t,u))))))).switchMap((t=>{const r=t.find((e=>null!=e));return null==r?e.Observable.empty():e.Observable.of(r)})).map((({formatted:e})=>[{oldRange:t.getBuffer().getRange(),newText:e,oldText:f}]));return(u.isEqual(o.getRange())?d.concat(p):p.concat(d)).first(Boolean,[])}))}_formatCodeOnTypeInTextEditor(t,r){return e.Observable.defer((()=>{if(1!==r.changes.length)return e.Observable.empty();const n=r.changes[0];if(!function(e){if(""!==e.oldText)return!1;if(""===e.oldText&&""===e.newText)return!1;if(e.newText.length>1&&!function(e){if(null==atom.packages.getActivePackage("bracket-matcher"))return!1;return atom.config.get("bracket-matcher.autocompleteCharacters").includes(e)}(e.newText))return!1;return!0}(n)||!Ue.getWithDefaults("atom-ide-code-format.formatOnType",!1))return e.Observable.empty();const o=n.newText[n.newText.length-1],i=[...this._onTypeProviders.getAllProvidersForEditor(t)];if(0===i.length)return e.Observable.empty();const a=t.getText(),s=t.getCursorBufferPosition().copy();return kr.switchMap((()=>Promise.all(i.map((e=>e.formatAtPosition(t,t.getCursorBufferPosition(),o)))))).switchMap((t=>{const r=t.findIndex((e=>e.length>0));return-1===r?e.Observable.empty():e.Observable.of({edits:h(t[r]),provider:i[r]})})).do((({edits:e,provider:r})=>{if(0!==e.length){if(function(e,t){if(e!==t)throw new Error("The file contents were changed before formatting was complete.")}(a,t.getText()),!ge(t.getBuffer(),e))throw new Error("Could not apply edits to text buffer.");r.keepCursorPosition&&t.setCursorBufferPosition(s)}})).map((({edits:e})=>e))}))}_onWillSaveProvider(){return{priority:0,timeout:2500,callback:this._formatCodeOnSaveInTextEditor.bind(this)}}_formatCodeOnSaveInTextEditor(t){const r=[...this._onSaveProviders.getAllProvidersForEditor(t)];return r.length>0?e.Observable.defer((()=>this._reportBusy(t,Promise.all(r.map((e=>e.formatOnSave(t)))),!1))).switchMap((t=>{const r=t.find((e=>e.length>0));return null==r?e.Observable.empty():e.Observable.of(r)})).flatMap((t=>e.Observable.of(...t))):function(e){const t=Ue.get("atom-ide-code-format.formatOnSave",{scope:e.getRootScopeDescriptor()});return null!=t&&t}(t)?this._formatCodeInTextEditor(t,t.getBuffer().getRange()).flatMap((t=>e.Observable.of(...t))):e.Observable.empty()}_reportBusy(e,t,r=!0){const n=this._busySignalService;if(null!=n){const o=e.getPath(),i=null!=o?Vt.basename(o):"<untitled>";return n.reportBusyWhile(`Formatting code in ${i}`,(()=>t),{revealTooltip:r})}return t}addRangeProvider(e){return this._rangeProviders.addProvider(e)}addFileProvider(e){return this._fileProviders.addProvider(e)}addOnTypeProvider(e){return this._onTypeProviders.addProvider(e)}addOnSaveProvider(e){return this._onSaveProviders.addProvider(e)}consumeBusySignal(e){return this._busySignalService=e,new v((()=>{this._busySignalService=null}))}dispose(){this._subscriptions.dispose()}}var Fr={formatOnSave:{title:"Format on Save",type:"boolean",default:!1,description:"Automatically format code upon saving for supported languages."},formatOnType:{title:"Format on Type",type:"boolean",default:!0,description:"Automatically format code as you type it for supported languages."}};let Lr;function Br(e){return Lr.addRangeProvider(e)}function $r(e){return Lr.addFileProvider(e)}function Wr(e){return Lr.addOnTypeProvider(e)}function qr(e){return Lr.addOnSaveProvider(e)}exports.activate=function(){Lr=new Ur},exports.config=Fr,exports.consumeBusySignal=function(e){return Lr.consumeBusySignal(e)},exports.consumeFileProvider=$r,exports.consumeLegacyProvider=function(e){if(e.grammarScopes=e.grammarScopes||(null!=e.selector?e.selector.split(", "):null),e.priority=null!=e.priority?e.priority:null!=e.inclusionPriority?e.inclusionPriority:0,"formatCode"in e)return Br(e);if("formatEntireFile"in e)return $r(e);if("formatAtPosition"in e)return Wr(e);if("formatOnSave"in e)return qr(e);throw new Error("Invalid code format provider")},exports.consumeOnSaveProvider=qr,exports.consumeOnTypeProvider=Wr,exports.consumeRangeProvider=Br,exports.deactivate=function(){Lr.dispose()};
//# sourceMappingURL=main.js.map
